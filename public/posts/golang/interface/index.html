<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ç¡¬æ ¸â€”â€”ä½ çœŸçš„æå®šGolangæ¥å£äº†ä¹ˆ | Whitea's Blog</title>
<meta name=keywords content="Go"><meta name=description content="â€œå…³äºgolangç±»å‹ç³»ç»Ÿã€æ¥å£ã€ç±»å‹æ–­è¨€çš„å­¦ä¹ ä¸æ€è€ƒâ€"><meta name=author content="Whitea"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/images/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/images/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/images/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/images/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/golang/interface/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="http://localhost:1313/posts/golang/interface/"><meta property="og:site_name" content="Whitea's Blog"><meta property="og:title" content="ç¡¬æ ¸â€”â€”ä½ çœŸçš„æå®šGolangæ¥å£äº†ä¹ˆ"><meta property="og:description" content="â€œå…³äºgolangç±»å‹ç³»ç»Ÿã€æ¥å£ã€ç±»å‹æ–­è¨€çš„å­¦ä¹ ä¸æ€è€ƒâ€"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-16T11:30:03+00:00"><meta property="article:modified_time" content="2025-03-16T11:30:03+00:00"><meta property="article:tag" content="Go"><meta property="og:image" content="http://localhost:1313/%3Cimage%20path/url%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Cimage%20path/url%3E"><meta name=twitter:title content="ç¡¬æ ¸â€”â€”ä½ çœŸçš„æå®šGolangæ¥å£äº†ä¹ˆ"><meta name=twitter:description content="â€œå…³äºgolangç±»å‹ç³»ç»Ÿã€æ¥å£ã€ç±»å‹æ–­è¨€çš„å­¦ä¹ ä¸æ€è€ƒâ€"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"ç¡¬æ ¸â€”â€”ä½ çœŸçš„æå®šGolangæ¥å£äº†ä¹ˆ","item":"http://localhost:1313/posts/golang/interface/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ç¡¬æ ¸â€”â€”ä½ çœŸçš„æå®šGolangæ¥å£äº†ä¹ˆ","name":"ç¡¬æ ¸â€”â€”ä½ çœŸçš„æå®šGolangæ¥å£äº†ä¹ˆ","description":"â€œå…³äºgolangç±»å‹ç³»ç»Ÿã€æ¥å£ã€ç±»å‹æ–­è¨€çš„å­¦ä¹ ä¸æ€è€ƒâ€","keywords":["Go"],"articleBody":"ç¼–è¯‘é˜¶æ®µæœ‰å˜é‡ã€ç±»å‹ã€æ–¹æ³•ç­‰ï¼Œé‚£åœ¨è¿è¡Œé˜¶æ®µåå°„ã€æ¥å£ã€ç±»å‹æ–­è¨€è¿™äº›è¯­è¨€ç‰¹æ€§æˆ–æœºåˆ¶æ˜¯æ€ä¹ˆåŠ¨æ€çš„è·å–æ•°æ®ç±»å‹ä¿¡æ¯å‘¢ï¼Ÿä»Šå¤©æˆ‘ä»¬å°±æ¥èŠèŠè¿™äº›é—®é¢˜å§ğŸ˜€\nç±»å‹ç³»ç»Ÿ é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“åœ¨Goä¸­ï¼Œè¿™äº›å±äºå†…ç½®ç±»å‹ï¼š\n1 2 3 4 5 6 7 8 9 10 bool int(32 or 64), int8, int16, int32, int64 uint(32 or 64), uint8(byte), uint16, uint32, uint64 float32, float64 string complex64, complex128 array -- å›ºå®šé•¿åº¦çš„æ•°ç»„ slice -- åºåˆ—æ•°ç»„ map -- æ˜ å°„ chan -- ç®¡é“ å½“ç„¶è¿˜æœ‰è‡ªå®šä¹‰ç±»å‹ï¼Œæ¯”å¦‚ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // custom type based on int type T int // that is different from the one below // type T = int // that just a alias for T, it's type is still int // struct type T struct { name string\t} // interface type T interface { Name() string } Goä¸å…è®¸ä¸ºå†…ç½®ç±»å‹æ·»åŠ æ–¹æ³•ï¼ŒåŒæ—¶æ¥å£ç±»å‹æ˜¯æ— æ•ˆçš„æ–¹æ³•æ¥æ”¶è€…ã€‚\næ•°æ®ç±»å‹è™½ç„¶å¤šï¼Œä½†æ˜¯æ— è®ºæ˜¯å†…ç½®ç±»å‹è¿˜æ˜¯è‡ªå®šä¹‰ç±»å‹ï¼Œéƒ½æœ‰å¯¹åº”çš„ç±»å‹æè¿°ä¿¡æ¯ï¼Œç§°ä¹‹ä¸ºç±»å‹å…ƒæ•°æ®ï¼Œ æ¯ç§ç±»å‹å…ƒæ•°æ®éƒ½æ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œè¿™äº›ç±»å‹å…ƒæ•°æ®å…±åŒæ„æˆäº†Goçš„ç±»å‹ç³»ç»Ÿã€‚ åœ¨Goæºç ä¸­å³ä¸ºruntime._typeï¼Œè¿™æ˜¯Goç±»å‹çš„è¿è¡Œæ—¶è¡¨ç¤ºã€‚\nç›®å‰è¿ç§»åˆ° internal/abi/type.goä¸‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 // runtime._type type _type struct { size uintptr ptrdata uintptr hash uint32 tflag tflag align uint8 fieldAlign uint8 kind uint8 equal func(unsafe.Pointer, unsafe.Pointer) bool gcdata *byte str nameOff ptrToThis typeOff } è¿™ç›¸å½“äºæ˜¯ç±»å‹çš„Headerï¼Œå½“ç„¶ä¸åŒçš„æ•°æ®ç±»å‹è¿˜éœ€è¦ä¸€äº›é¢å¤–çš„æè¿°ä¿¡æ¯ ä¾‹å¦‚sliceTypeç±»å‹æœ‰ä¸€ä¸ª*_typeç±»å‹çš„å˜é‡ï¼ŒæŒ‡å‘åˆ‡ç‰‡ä¸­å…ƒç´ ç±»å‹çš„å…ƒæ•°æ® []stirngç±»å‹è¿™é‡Œçš„Elemæ‰€æŒ‡å‘çš„ç±»å‹å°±æ˜¯stringçš„ç±»å‹å…ƒæ•°æ®\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 // slicetype type SliceType struct { Type Elem *Type // slice element type } // maptype type MapType struct { Type Key *Type Elem *Type Bucket *Type // internal type representing a hash bucket // function for hashing keys (ptr to key, seed) -\u003e hash Hasher func(unsafe.Pointer, uintptr) uintptr KeySize uint8 // size of key slot ValueSize uint8 // size of elem slot BucketSize uint16 // size of bucket Flags uint32 } // functype type FuncType struct { Type InCount uint16 OutCount uint16 // top bit is set if last input parameter is ... } // interfacetype type InterfaceType struct { Type PkgPath Name // import path Methods []Imethod // sorted by hash } ... ä½†å¦‚æœæ˜¯è‡ªå®šä¹‰ç±»å‹ï¼Œä¼šæœ‰ä¸€ä¸ªuncommontypeç”¨äºè®°å½•ä¸€äº›é¢å¤–çš„æè¿°ä¿¡æ¯\n1 2 3 4 5 6 7 type UncommonType struct { PkgPath NameOff // import path; empty for built-in types like int, string Mcount uint16 // number of methods Xcount uint16 // number of exported methods Moff uint32 // offset from this uncommontype to [mcount]Method _ uint32 // unused } æ¯”å¦‚è¿™é‡Œçš„Moffå°±è®°å½•è¿™äº›æ–¹æ³•å…ƒæ•°æ®ç»„æˆçš„æ•°ç»„ç›¸å¯¹äºè¿™ä¸ªuncommontypeç»“æ„ä½“åç§»äº†å¤šå°‘ä¸ªå­—èŠ‚ï¼Œè¿›è€Œæˆ‘ä»¬å°±å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•å…ƒæ•°æ®\n1 2 3 4 5 6 type Method struct { Name NameOff // name of method Mtyp TypeOff // method type (without receiver) Ifn TextOff // fn used in interface call (one-word receiver) Tfn TextOff // fn used for normal method call } å› æ­¤è®°å¿†ä¸‹æ¥çš„è¯ç±»å‹ä¿¡æ¯å°±æ˜¯_typeåŠ ä¸Šä¸€å †é¢å¤–çš„ä¿¡æ¯ç½¢äº†\n1 2 3 4 type T struct{ Type // meta data ... // extra data } é‚£å°±è®¤è¯†ä¸€ä¸‹æ¥å£å§ Go è¯­è¨€ä½¿ç”¨runtime.ifaceè¡¨ç¤ºç¬¬ä¸€ç§æ¥å£ï¼Œä½¿ç”¨runtime.efaceè¡¨ç¤ºç¬¬äºŒç§ä¸åŒ…å«ä»»ä½•æ–¹æ³•çš„æ¥å£ interface{}ï¼Œä¸¤ç§æ¥å£è™½ç„¶éƒ½ä½¿ç”¨interfaceå£°æ˜ï¼Œä½†æ˜¯ç”±äºåè€…åœ¨Goä¸­å¾ˆå¸¸è§ï¼Œæ‰€ä»¥åœ¨å®ç°æ—¶ä½¿ç”¨äº†ç‰¹æ®Šçš„ç±»å‹ä»ä½†å•ç‹¬åŒºåˆ†å‡ºæ¥ã€‚\nç©ºæ¥å£ 1 2 3 4 type eface struct { _type *_type // dynamic type data unsafe.Pointer// dynamic data } å½“åˆå§‹åŒ–çš„æ—¶å€™var a interface{}ï¼Œ_type å’Œ data éƒ½ä¸ºnilï¼Œä½†å½“æˆ‘ä»¬ä¸ºå…¶èµ‹å€¼çš„æ—¶å€™ æ¯”å¦‚èµ‹å€¼*os.Fileç»™è¿™ä¸ªç©ºæ¥å£ï¼Œ_typeå°±ä¼šæŒ‡å‘è¿™ä¸ªè‡ªå®šä¹‰ç±»å‹çš„ç±»å‹å…ƒæ•°æ®ï¼Œdataå°±ä¼šç›´æ¥è¢«è¿™ä¸ªæŒ‡é’ˆèµ‹å€¼ã€‚\néç©ºæ¥å£ å…¶å®å°±æ˜¯æœ‰æ–¹æ³•åˆ—è¡¨çš„æ¥å£ç±»å‹ï¼Œå¦‚æœä¸€ä¸ªå˜é‡è¦æƒ³èµ‹å€¼ç»™ä¸€ä¸ªéç©ºæ¥å£ç±»å‹ï¼Œå¿…é¡»è¦å®ç°è¯¥æ¥å£è¦æ±‚çš„æ‰€æœ‰æ–¹æ³•æ‰è¡Œã€‚ 1 2 3 4 type iface struct { tab *itab // method list, dynamic type ... data unsafe.Pointer // dynamic data } ä¸ç©ºæ¥å£ä¸€æ ·ï¼Œdataä¸€å®šå­˜å‚¨å®ç°è¿™ä¸ªæ¥å£çš„åŠ¨æ€å€¼ï¼Œå› æ­¤æ¥å£æ‰€è¦å®ç°çš„æ–¹æ³•åˆ—è¡¨ä»¥åŠåŠ¨æ€ç±»å‹ä¿¡æ¯ç­‰ç­‰é‚£å°±åªèƒ½å­˜å‚¨åœ¨è¿™ä¸ª*itabé‡Œé¢å•¦\n1 2 3 4 5 6 type ITab struct { Inter *InterfaceType Type *Type Hash uint32 // copy of Type.Hash. Used for type switches. Fun [1]uintptr // variable sized. fun[0]==0 means Type does not implement Inter. } ä¾‹å¦‚æˆ‘ä»¬åˆå§‹åŒ–ä¸€ä¸ªio.ReadWriterçš„æ¥å£ï¼Œtab å’Œ data éƒ½ä¸ºnilï¼Œä½†å½“æˆ‘ä»¬ä¸ºå…¶èµ‹å€¼*os.Fileçš„æ—¶å€™ï¼Œdataå°±ä¼šç›´æ¥è¢«è¿™ä¸ªæŒ‡é’ˆèµ‹å€¼ï¼Œè€Œtabä¼šæŒ‡å‘ä¸€ä¸ªitabçš„ç»“æ„ä½“ï¼ŒinteræŒ‡å‘io.ReadWriterçš„æ¥å£ä¿¡æ¯ï¼ŒtypeæŒ‡å‘*os.Fileçš„ç±»å‹å…ƒä¿¡æ¯ï¼Œhashä¸ºç±»å‹å…ƒæ•°æ®ä¸­æ‹·è´çš„å“ˆå¸Œï¼Œfunä¸ºå„ä¸ªæ–¹æ³•çš„åœ°å€çš„æ‹·è´ itabç¼“å­˜ ä½†å…³äºitabè¦é‡ç‚¹å¼ºè°ƒçš„æ˜¯ï¼Œä¸€æ—¦æ¥å£ç±»å‹ç¡®å®šäº†ï¼ŒåŠ¨æ€ç±»å‹çš„å…ƒä¿¡æ¯ç¡®å®šäº†ï¼Œé‚£ä¹ˆitabçš„å†…å®¹å°±ä¸ä¼šæ”¹å˜äº†ï¼Œæ‰€ä»¥itabæ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œæ‰€ä»¥Goè¿è¡Œçš„æ—¶å€™ä¼šæŠŠç”¨åˆ°çš„itebç»“æ„ä½“ç¼“å­˜èµ·æ¥ï¼Œå¹¶ä¸”ä»¥\u003cæ¥å£ç±»å‹ï¼ŒåŠ¨æ€ç±»å‹\u003eä¸ºkeyï¼Œitebä¸ºvalueæ„å»ºå‡ºä¸€ä¸ªå“ˆå¸Œè¡¨ã€‚è¿™é‡Œä½¿ç”¨itabHashFuncæ–¹æ³•å¾—åˆ°keyè¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæœ‰å°±ç›´æ¥ä½¿ç”¨ï¼Œæ²¡æœ‰å°±ä¼šåˆ›å»ºæ–°çš„itabç»“æ„ä½“æ·»åŠ åˆ°è¿™ä¸ªå“ˆå¸Œè¡¨ä¸­\n1 2 3 4 5 6 7 8 9 10 11 // Note: change the formula in the mallocgc call in itabAdd if you change these fields. type itabTableType struct { size uintptr // length of entries array. Always a power of 2. count uintptr // current number of filled entries. entries [itabInitSize]*itab // really [size] large } func itabHashFunc(inter *interfacetype, typ *_type) uintptr { // compiler has provided some good hash codes for us. return uintptr(inter.Type.Hash ^ typ.Hash) } ç±»å‹æ–­è¨€ åˆšåˆšèŠè¿‡äº†ç©ºæ¥å£å’Œéç©ºæ¥å£ä¸¤ç§æ¥å£ï¼Œè€Œç±»å‹æ–­è¨€å°±æ˜¯ä½œç”¨åœ¨æ¥å£å€¼ä¹‹ä¸Š\n1 æ¥å£æˆ–è€…éç©ºæ¥å£.(å…·ä½“ç±»å‹æˆ–éç©ºæ¥å£ç±»å‹) è¿™å°±æ’åˆ—ç»„åˆå‡ºæ¥äº†4ç§ç±»å‹æ–­è¨€ï¼Œé‚£æˆ‘ä»¬å°±é€ä¸€æ¥çœ‹çœ‹ï¼Œä»–ä»¬æ˜¯æ€æ ·è¿›è¡Œç±»å‹æ–­è¨€çš„\nç©ºæ¥å£.(å…·ä½“ç±»å‹) 1 2 3 4 type eface struct { _type *_type // dynamic type data unsafe.Pointer// dynamic data } æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ç©ºæ¥å£ï¼Œæ˜¾ç„¶ï¼Œç±»å‹æ–­è¨€çš„æ—¶å€™åªéœ€è¦æ£€æŸ¥è¿™é‡Œçš„_typeæ˜¯å¦æ˜¯å…·ä½“ç±»å‹çš„ç±»å‹å…ƒæ•°æ®å³å¯\n1 2 3 4 var e interface{} f := \"whitea\" e = f r, ok := e.(*os.File) è¿™é‡Œdataå°±ä¼šè¢«fèµ‹å€¼ï¼Œç±»å‹å…ƒæ•°æ®æ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œè¿™é‡Œä¹Ÿæ˜¯å¯¹çš„ä¸Šçš„ï¼Œæ‰€ä»¥æ–­è¨€æˆåŠŸï¼Œrå³ä¸ºf,okä¸ºtrue\n1 2 3 4 var e interface{} f := \"whitea\" e = f r, ok := e.(string) è¿™é‡Œç”±äºç±»å‹å…ƒæ•°æ®å¯¹ä¸ä¸Šï¼Œå› æ­¤rå³ä¸ºnil,okä¸ºfalse\néç©ºæ¥å£.(å…·ä½“ç±»å‹) 1 2 3 4 type iface struct { tab *itab // method list, dynamic type ... data unsafe.Pointer // dynamic data } åŒæ ·å…ˆæŠŠéç©ºæ¥å£ç±»å‹çš„ç»“æ„æ‹¿è¿‡æ¥ï¼Œä¹‹å‰è¯´åˆ°è¿‡æ‰€æœ‰çš„itabç»“æ„ä½“éƒ½ä¼šè¢«ç¼“å­˜èµ·æ¥ï¼Œç„¶åé€šè¿‡\u003cæ¥å£ç±»å‹ï¼Œç±»å‹å…ƒæ•°æ®\u003eä¸ºkeyç¼“å­˜ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿæ˜¯åªéœ€è¦è®¡ç®—ä¸€ä¸‹keyçš„ä½ç½®ï¼Œæ¯”è¾ƒä¸€æ¬¡å³å¯\n1 2 3 4 var rw io.ReadWriter f, _ := os.Open(\"whitea.md\") re = f r, ok := rw.(*os.File) è¿™é‡Œdataå°±ä¼šè¢«fèµ‹å€¼ï¼Œç±»å‹å…ƒæ•°æ®å’Œæ¥å£ç±»å‹å“ˆå¸Œå¼‚æˆ–è¿ç®—åæŸ¥æ‰¾itabä¹Ÿèƒ½å¯¹çš„ä¸Šï¼Œæ‰€ä»¥æ–­è¨€æˆåŠŸï¼Œrå³ä¸ºf,okä¸ºtrue\n1 2 3 4 var rw io.ReadWriter f ï¼š= whitea{name: \"whitea\"} re = f r, ok := rw.(*os.File) è¿™é‡Œdataå°±ä¼šè¢«fèµ‹å€¼ï¼Œç±»å‹å…ƒæ•°æ®å’Œæ¥å£ç±»å‹å“ˆå¸Œå¼‚æˆ–è¿ç®—åæŸ¥æ‰¾itabçš„ç±»å‹å…ƒæ•°æ®ä¸ä¸€æ ·ï¼Œitabå¯¹ä¸ä¸Šï¼Œæ‰€ä»¥æ–­è¨€å¤±è´¥ï¼Œrå³ä¸ºnil,okä¸ºfalse\nç©ºæ¥å£.(éç©ºæ¥å£) åŒç†æ˜¯éœ€è¦æ¯”è¾ƒ_typeæ˜¯å¦ä¸€è‡´ï¼Œä½†æ˜¯è¿™é‡Œè¿˜éœ€è¦æ¯”è¾ƒè¿™ä¸ªç±»å‹æ˜¯å¦å®ç°äº†éç©ºæ¥å£ç±»å‹çš„æ‰€æœ‰æ–¹æ³•ï¼Œå› æ­¤è¿˜æ¶‰åŠåˆ°itabæŸ¥æ‰¾ä»¥åŠfunæ•°ç»„çš„æ¯”è¾ƒç­‰æ“ä½œ ä½†æ˜¯è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ¯”è¾ƒå¤±è´¥çš„itabç»“æ„ä½“ä¹Ÿä¼šè¢«ç¼“å­˜èµ·æ¥ï¼ŒåŒæ—¶fun[0] = 0ç”¨äºè¡¨ç¤ºè¿™ä¸ªåŠ¨æ€ç±»å‹å¹¶æ²¡æœ‰å®ç°å¯¹åº”çš„æ¥å£ï¼Œè¿™æ ·ä¹‹åå†æ¬¡é‡åˆ°åŒç§çš„ç±»å‹æ–­è¨€æ—¶å€™å°±å¯ä»¥ç›´æ¥è¿”å›falseäº†ï¼Œå°±ä¸ç”¨å†å»æ£€æŸ¥æ–¹æ³•åˆ—è¡¨äº†ã€‚\néç©ºæ¥å£.(éç©ºæ¥å£) è¿™é‡ŒåŒæ ·ä¸ä»…ä»…éœ€è¦æ¯”è¾ƒitabé‡Œé¢çš„ç±»å‹å…ƒæ•°æ®ï¼Œä¹Ÿè¦æ¯”è¾ƒitabé‡Œé¢çš„æ¥å£ç±»å‹å’Œæ–¹æ³•åˆ—è¡¨æ˜¯å¦éƒ½å®ç°äº†ï¼Œè¿™åŒæ ·æ¶‰åŠå»ç¼“å­˜é‡Œé¢å¯»æ‰¾ã€‚ 1 2 3 4 var w io.Writer f, _ := os.Open(\"whitea.md\") re = f r, ok := rw.(*os.File) è¿™é‡Œæ˜¯æ–­è¨€æˆåŠŸçš„\n1 2 3 4 5 6 7 8 9 10 11 12 var rw io.ReadWriter f ï¼š= whitea{name: \"whitea\"} re = f r, ok := rw.(*os.File) type whitea struct { name string } func (w whitea) Write(b []byte) (n int, err error) { return len(w.name), nil } è¿™é‡Œçš„è‡ªå®šä¹‰ç±»å‹åªå®ç°äº†Writeæ¥å£ï¼Œè¿˜æœ‰Readæ¥å£æ²¡æœ‰å®ç°ï¼Œå› æ­¤ç±»å‹æ–­è¨€å¤±è´¥ï¼Œè¿™ä¸ªitabè¢«ç¼“å­˜èµ·æ¥ï¼Œrå³ä¸ºnil,okä¸ºfalse\nå› æ­¤ç±»å‹æ–­è¨€çš„å…³é”®å°±åœ¨äºæ˜ç¡®æ¥å£çš„åŠ¨æ€ç±»å‹(_type)ä»¥åŠå¯¹åº”çš„ç±»å‹å®ç°äº†å“ªäº›æ–¹æ³•ã€‚è€Œéœ€è¦æ˜ç¡®è¿™äº›åˆ™ä¾èµ–ä¸ç±»å‹å…ƒæ•°æ®ä»¥åŠç©ºæ¥å£å’Œéç©ºæ¥å£çš„â€œæ•°æ®æ¥å£â€\nOKï¼Goçš„ç±»å‹ç³»ç»Ÿã€æ¥å£ã€ç±»å‹æ–­è¨€å°±å…ˆè®²åˆ°è¿™é‡Œã€‚\nä½œä¸ºä¸€åå°ç™½Gopher,æœ‰ä»»ä½•é—®é¢˜éƒ½å¯ä»¥è”ç³»æˆ‘ï¼Œå½“ç„¶ä¹Ÿæ¬¢è¿ä¸æˆ‘äº¤æµæŠ€æœ¯ç›¸å…³çš„é—®é¢˜ï¼Œæ„Ÿè°¢ä½ çš„é˜…è¯»ğŸ¤—\n","wordCount":"809","inLanguage":"en","image":"http://localhost:1313/%3Cimage%20path/url%3E","datePublished":"2025-03-16T11:30:03Z","dateModified":"2025-03-16T11:30:03Z","author":{"@type":"Person","name":"Whitea"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/golang/interface/"},"publisher":{"@type":"Organization","name":"Whitea's Blog","logo":{"@type":"ImageObject","url":"http://localhost:1313/images/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/archives/ title=Archives><span>Archives</span></a></li><li><a href=http://localhost:1313/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;Â»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">ç¡¬æ ¸â€”â€”ä½ çœŸçš„æå®šGolangæ¥å£äº†ä¹ˆ</h1><div class=post-description>â€œå…³äºgolangç±»å‹ç³»ç»Ÿã€æ¥å£ã€ç±»å‹æ–­è¨€çš„å­¦ä¹ ä¸æ€è€ƒâ€</div><div class=post-meta><span title='2025-03-16 11:30:03 +0000 +0000'>March 16, 2025</span>&nbsp;Â·&nbsp;4 min&nbsp;Â·&nbsp;809 words&nbsp;Â·&nbsp;Whitea&nbsp;|&nbsp;<a href=https://github.com/Whitea029/myblog/blob/main/content/posts/golang/interface/index.md rel="noopener noreferrer" target=_blank>Source Code</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#ç±»å‹ç³»ç»Ÿ>ç±»å‹ç³»ç»Ÿ</a></li><li><a href=#é‚£å°±è®¤è¯†ä¸€ä¸‹æ¥å£å§>é‚£å°±è®¤è¯†ä¸€ä¸‹æ¥å£å§</a></li><li><a href=#ç±»å‹æ–­è¨€>ç±»å‹æ–­è¨€</a></li></ul></nav></div></details></div><div class=post-content><p>ç¼–è¯‘é˜¶æ®µæœ‰å˜é‡ã€ç±»å‹ã€æ–¹æ³•ç­‰ï¼Œé‚£åœ¨è¿è¡Œé˜¶æ®µåå°„ã€æ¥å£ã€ç±»å‹æ–­è¨€è¿™äº›è¯­è¨€ç‰¹æ€§æˆ–æœºåˆ¶æ˜¯æ€ä¹ˆåŠ¨æ€çš„è·å–æ•°æ®ç±»å‹ä¿¡æ¯å‘¢ï¼Ÿä»Šå¤©æˆ‘ä»¬å°±æ¥èŠèŠè¿™äº›é—®é¢˜å§ğŸ˜€</p><h2 id=ç±»å‹ç³»ç»Ÿ>ç±»å‹ç³»ç»Ÿ<a hidden class=anchor aria-hidden=true href=#ç±»å‹ç³»ç»Ÿ>#</a></h2><p>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“åœ¨Goä¸­ï¼Œè¿™äº›å±äºå†…ç½®ç±»å‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-0-1><a class=lnlinks href=#hl-0-1> 1</a>
</span><span class=lnt id=hl-0-2><a class=lnlinks href=#hl-0-2> 2</a>
</span><span class=lnt id=hl-0-3><a class=lnlinks href=#hl-0-3> 3</a>
</span><span class=lnt id=hl-0-4><a class=lnlinks href=#hl-0-4> 4</a>
</span><span class=lnt id=hl-0-5><a class=lnlinks href=#hl-0-5> 5</a>
</span><span class=lnt id=hl-0-6><a class=lnlinks href=#hl-0-6> 6</a>
</span><span class=lnt id=hl-0-7><a class=lnlinks href=#hl-0-7> 7</a>
</span><span class=lnt id=hl-0-8><a class=lnlinks href=#hl-0-8> 8</a>
</span><span class=lnt id=hl-0-9><a class=lnlinks href=#hl-0-9> 9</a>
</span><span class=lnt id=hl-0-10><a class=lnlinks href=#hl-0-10>10</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>bool
</span></span><span class=line><span class=cl>int(32 or 64), int8, int16, int32, int64
</span></span><span class=line><span class=cl>uint(32 or 64), uint8(byte), uint16, uint32, uint64
</span></span><span class=line><span class=cl>float32, float64
</span></span><span class=line><span class=cl>string
</span></span><span class=line><span class=cl>complex64, complex128
</span></span><span class=line><span class=cl>array    -- å›ºå®šé•¿åº¦çš„æ•°ç»„
</span></span><span class=line><span class=cl>slice   -- åºåˆ—æ•°ç»„
</span></span><span class=line><span class=cl>map     -- æ˜ å°„
</span></span><span class=line><span class=cl>chan    -- ç®¡é“
</span></span></code></pre></td></tr></table></div></div><p>å½“ç„¶è¿˜æœ‰è‡ªå®šä¹‰ç±»å‹ï¼Œæ¯”å¦‚ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-1-1><a class=lnlinks href=#hl-1-1> 1</a>
</span><span class=lnt id=hl-1-2><a class=lnlinks href=#hl-1-2> 2</a>
</span><span class=lnt id=hl-1-3><a class=lnlinks href=#hl-1-3> 3</a>
</span><span class=lnt id=hl-1-4><a class=lnlinks href=#hl-1-4> 4</a>
</span><span class=lnt id=hl-1-5><a class=lnlinks href=#hl-1-5> 5</a>
</span><span class=lnt id=hl-1-6><a class=lnlinks href=#hl-1-6> 6</a>
</span><span class=lnt id=hl-1-7><a class=lnlinks href=#hl-1-7> 7</a>
</span><span class=lnt id=hl-1-8><a class=lnlinks href=#hl-1-8> 8</a>
</span><span class=lnt id=hl-1-9><a class=lnlinks href=#hl-1-9> 9</a>
</span><span class=lnt id=hl-1-10><a class=lnlinks href=#hl-1-10>10</a>
</span><span class=lnt id=hl-1-11><a class=lnlinks href=#hl-1-11>11</a>
</span><span class=lnt id=hl-1-12><a class=lnlinks href=#hl-1-12>12</a>
</span><span class=lnt id=hl-1-13><a class=lnlinks href=#hl-1-13>13</a>
</span><span class=lnt id=hl-1-14><a class=lnlinks href=#hl-1-14>14</a>
</span><span class=lnt id=hl-1-15><a class=lnlinks href=#hl-1-15>15</a>
</span><span class=lnt id=hl-1-16><a class=lnlinks href=#hl-1-16>16</a>
</span><span class=lnt id=hl-1-17><a class=lnlinks href=#hl-1-17>17</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// custom type based on int</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>T</span> <span class=kt>int</span> 
</span></span><span class=line><span class=cl><span class=c1>// that is different from the one below</span>
</span></span><span class=line><span class=cl><span class=c1>// type T = int</span>
</span></span><span class=line><span class=cl><span class=c1>// that just a alias for T, it&#39;s type is still int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// struct</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>T</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>name</span> <span class=kt>string</span>	
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// interface</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>T</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>Name</span><span class=p>()</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Goä¸å…è®¸ä¸ºå†…ç½®ç±»å‹æ·»åŠ æ–¹æ³•ï¼ŒåŒæ—¶æ¥å£ç±»å‹æ˜¯æ— æ•ˆçš„æ–¹æ³•æ¥æ”¶è€…ã€‚</p><p>æ•°æ®ç±»å‹è™½ç„¶å¤šï¼Œä½†æ˜¯æ— è®ºæ˜¯å†…ç½®ç±»å‹è¿˜æ˜¯è‡ªå®šä¹‰ç±»å‹ï¼Œéƒ½æœ‰å¯¹åº”çš„ç±»å‹æè¿°ä¿¡æ¯ï¼Œç§°ä¹‹ä¸º<strong>ç±»å‹å…ƒæ•°æ®</strong>ï¼Œ
æ¯ç§ç±»å‹å…ƒæ•°æ®éƒ½æ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œè¿™äº›ç±»å‹å…ƒæ•°æ®å…±åŒæ„æˆäº†Goçš„ç±»å‹ç³»ç»Ÿã€‚
åœ¨Goæºç ä¸­å³ä¸º<code>runtime._type</code>ï¼Œè¿™æ˜¯Goç±»å‹çš„è¿è¡Œæ—¶è¡¨ç¤ºã€‚</p><blockquote><p>ç›®å‰è¿ç§»åˆ° internal/abi/type.goä¸‹</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-2-1><a class=lnlinks href=#hl-2-1> 1</a>
</span><span class=lnt id=hl-2-2><a class=lnlinks href=#hl-2-2> 2</a>
</span><span class=lnt id=hl-2-3><a class=lnlinks href=#hl-2-3> 3</a>
</span><span class=lnt id=hl-2-4><a class=lnlinks href=#hl-2-4> 4</a>
</span><span class=lnt id=hl-2-5><a class=lnlinks href=#hl-2-5> 5</a>
</span><span class=lnt id=hl-2-6><a class=lnlinks href=#hl-2-6> 6</a>
</span><span class=lnt id=hl-2-7><a class=lnlinks href=#hl-2-7> 7</a>
</span><span class=lnt id=hl-2-8><a class=lnlinks href=#hl-2-8> 8</a>
</span><span class=lnt id=hl-2-9><a class=lnlinks href=#hl-2-9> 9</a>
</span><span class=lnt id=hl-2-10><a class=lnlinks href=#hl-2-10>10</a>
</span><span class=lnt id=hl-2-11><a class=lnlinks href=#hl-2-11>11</a>
</span><span class=lnt id=hl-2-12><a class=lnlinks href=#hl-2-12>12</a>
</span><span class=lnt id=hl-2-13><a class=lnlinks href=#hl-2-13>13</a>
</span><span class=lnt id=hl-2-14><a class=lnlinks href=#hl-2-14>14</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// runtime._type</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>_type</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>size</span>       <span class=kt>uintptr</span>
</span></span><span class=line><span class=cl>	<span class=nx>ptrdata</span>    <span class=kt>uintptr</span>
</span></span><span class=line><span class=cl>	<span class=nx>hash</span>       <span class=kt>uint32</span>
</span></span><span class=line><span class=cl>	<span class=nx>tflag</span>      <span class=nx>tflag</span>
</span></span><span class=line><span class=cl>	<span class=nx>align</span>      <span class=kt>uint8</span>
</span></span><span class=line><span class=cl>	<span class=nx>fieldAlign</span> <span class=kt>uint8</span>
</span></span><span class=line><span class=cl>	<span class=nx>kind</span>       <span class=kt>uint8</span>
</span></span><span class=line><span class=cl>	<span class=nx>equal</span>      <span class=kd>func</span><span class=p>(</span><span class=nx>unsafe</span><span class=p>.</span><span class=nx>Pointer</span><span class=p>,</span> <span class=nx>unsafe</span><span class=p>.</span><span class=nx>Pointer</span><span class=p>)</span> <span class=kt>bool</span>
</span></span><span class=line><span class=cl>	<span class=nx>gcdata</span>     <span class=o>*</span><span class=kt>byte</span>
</span></span><span class=line><span class=cl>	<span class=nx>str</span>        <span class=nx>nameOff</span>
</span></span><span class=line><span class=cl>	<span class=nx>ptrToThis</span>  <span class=nx>typeOff</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™ç›¸å½“äºæ˜¯ç±»å‹çš„Headerï¼Œå½“ç„¶ä¸åŒçš„æ•°æ®ç±»å‹è¿˜éœ€è¦<strong>ä¸€äº›é¢å¤–çš„æè¿°ä¿¡æ¯</strong>
ä¾‹å¦‚<code>sliceType</code>ç±»å‹æœ‰ä¸€ä¸ª<code>*_type</code>ç±»å‹çš„å˜é‡ï¼ŒæŒ‡å‘åˆ‡ç‰‡ä¸­å…ƒç´ ç±»å‹çš„å…ƒæ•°æ®
<code>[]stirng</code>ç±»å‹è¿™é‡Œçš„Elemæ‰€æŒ‡å‘çš„ç±»å‹å°±æ˜¯stringçš„ç±»å‹å…ƒæ•°æ®</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-3-1><a class=lnlinks href=#hl-3-1> 1</a>
</span><span class=lnt id=hl-3-2><a class=lnlinks href=#hl-3-2> 2</a>
</span><span class=lnt id=hl-3-3><a class=lnlinks href=#hl-3-3> 3</a>
</span><span class=lnt id=hl-3-4><a class=lnlinks href=#hl-3-4> 4</a>
</span><span class=lnt id=hl-3-5><a class=lnlinks href=#hl-3-5> 5</a>
</span><span class=lnt id=hl-3-6><a class=lnlinks href=#hl-3-6> 6</a>
</span><span class=lnt id=hl-3-7><a class=lnlinks href=#hl-3-7> 7</a>
</span><span class=lnt id=hl-3-8><a class=lnlinks href=#hl-3-8> 8</a>
</span><span class=lnt id=hl-3-9><a class=lnlinks href=#hl-3-9> 9</a>
</span><span class=lnt id=hl-3-10><a class=lnlinks href=#hl-3-10>10</a>
</span><span class=lnt id=hl-3-11><a class=lnlinks href=#hl-3-11>11</a>
</span><span class=lnt id=hl-3-12><a class=lnlinks href=#hl-3-12>12</a>
</span><span class=lnt id=hl-3-13><a class=lnlinks href=#hl-3-13>13</a>
</span><span class=lnt id=hl-3-14><a class=lnlinks href=#hl-3-14>14</a>
</span><span class=lnt id=hl-3-15><a class=lnlinks href=#hl-3-15>15</a>
</span><span class=lnt id=hl-3-16><a class=lnlinks href=#hl-3-16>16</a>
</span><span class=lnt id=hl-3-17><a class=lnlinks href=#hl-3-17>17</a>
</span><span class=lnt id=hl-3-18><a class=lnlinks href=#hl-3-18>18</a>
</span><span class=lnt id=hl-3-19><a class=lnlinks href=#hl-3-19>19</a>
</span><span class=lnt id=hl-3-20><a class=lnlinks href=#hl-3-20>20</a>
</span><span class=lnt id=hl-3-21><a class=lnlinks href=#hl-3-21>21</a>
</span><span class=lnt id=hl-3-22><a class=lnlinks href=#hl-3-22>22</a>
</span><span class=lnt id=hl-3-23><a class=lnlinks href=#hl-3-23>23</a>
</span><span class=lnt id=hl-3-24><a class=lnlinks href=#hl-3-24>24</a>
</span><span class=lnt id=hl-3-25><a class=lnlinks href=#hl-3-25>25</a>
</span><span class=lnt id=hl-3-26><a class=lnlinks href=#hl-3-26>26</a>
</span><span class=lnt id=hl-3-27><a class=lnlinks href=#hl-3-27>27</a>
</span><span class=lnt id=hl-3-28><a class=lnlinks href=#hl-3-28>28</a>
</span><span class=lnt id=hl-3-29><a class=lnlinks href=#hl-3-29>29</a>
</span><span class=lnt id=hl-3-30><a class=lnlinks href=#hl-3-30>30</a>
</span><span class=lnt id=hl-3-31><a class=lnlinks href=#hl-3-31>31</a>
</span><span class=lnt id=hl-3-32><a class=lnlinks href=#hl-3-32>32</a>
</span><span class=lnt id=hl-3-33><a class=lnlinks href=#hl-3-33>33</a>
</span><span class=lnt id=hl-3-34><a class=lnlinks href=#hl-3-34>34</a>
</span><span class=lnt id=hl-3-35><a class=lnlinks href=#hl-3-35>35</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// slicetype</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>SliceType</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Type</span>
</span></span><span class=line><span class=cl>	<span class=nx>Elem</span> <span class=o>*</span><span class=nx>Type</span> <span class=c1>// slice element type</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// maptype</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>MapType</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Type</span>
</span></span><span class=line><span class=cl>	<span class=nx>Key</span>    <span class=o>*</span><span class=nx>Type</span>
</span></span><span class=line><span class=cl>	<span class=nx>Elem</span>   <span class=o>*</span><span class=nx>Type</span>
</span></span><span class=line><span class=cl>	<span class=nx>Bucket</span> <span class=o>*</span><span class=nx>Type</span> <span class=c1>// internal type representing a hash bucket</span>
</span></span><span class=line><span class=cl>	<span class=c1>// function for hashing keys (ptr to key, seed) -&gt; hash</span>
</span></span><span class=line><span class=cl>	<span class=nx>Hasher</span>     <span class=kd>func</span><span class=p>(</span><span class=nx>unsafe</span><span class=p>.</span><span class=nx>Pointer</span><span class=p>,</span> <span class=kt>uintptr</span><span class=p>)</span> <span class=kt>uintptr</span>
</span></span><span class=line><span class=cl>	<span class=nx>KeySize</span>    <span class=kt>uint8</span>  <span class=c1>// size of key slot</span>
</span></span><span class=line><span class=cl>	<span class=nx>ValueSize</span>  <span class=kt>uint8</span>  <span class=c1>// size of elem slot</span>
</span></span><span class=line><span class=cl>	<span class=nx>BucketSize</span> <span class=kt>uint16</span> <span class=c1>// size of bucket</span>
</span></span><span class=line><span class=cl>	<span class=nx>Flags</span>      <span class=kt>uint32</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// functype</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>FuncType</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Type</span>
</span></span><span class=line><span class=cl>	<span class=nx>InCount</span>  <span class=kt>uint16</span>
</span></span><span class=line><span class=cl>	<span class=nx>OutCount</span> <span class=kt>uint16</span> <span class=c1>// top bit is set if last input parameter is ...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// interfacetype</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>InterfaceType</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Type</span>
</span></span><span class=line><span class=cl>	<span class=nx>PkgPath</span> <span class=nx>Name</span>      <span class=c1>// import path</span>
</span></span><span class=line><span class=cl>	<span class=nx>Methods</span> <span class=p>[]</span><span class=nx>Imethod</span> <span class=c1>// sorted by hash</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></td></tr></table></div></div><p>ä½†å¦‚æœæ˜¯è‡ªå®šä¹‰ç±»å‹ï¼Œä¼šæœ‰ä¸€ä¸ª<code>uncommontype</code>ç”¨äºè®°å½•ä¸€äº›é¢å¤–çš„æè¿°ä¿¡æ¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-4-1><a class=lnlinks href=#hl-4-1>1</a>
</span><span class=lnt id=hl-4-2><a class=lnlinks href=#hl-4-2>2</a>
</span><span class=lnt id=hl-4-3><a class=lnlinks href=#hl-4-3>3</a>
</span><span class=lnt id=hl-4-4><a class=lnlinks href=#hl-4-4>4</a>
</span><span class=lnt id=hl-4-5><a class=lnlinks href=#hl-4-5>5</a>
</span><span class=lnt id=hl-4-6><a class=lnlinks href=#hl-4-6>6</a>
</span><span class=lnt id=hl-4-7><a class=lnlinks href=#hl-4-7>7</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>UncommonType</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>PkgPath</span> <span class=nx>NameOff</span> <span class=c1>// import path; empty for built-in types like int, string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Mcount</span>  <span class=kt>uint16</span>  <span class=c1>// number of methods</span>
</span></span><span class=line><span class=cl>	<span class=nx>Xcount</span>  <span class=kt>uint16</span>  <span class=c1>// number of exported methods</span>
</span></span><span class=line><span class=cl>	<span class=nx>Moff</span>    <span class=kt>uint32</span>  <span class=c1>// offset from this uncommontype to [mcount]Method</span>
</span></span><span class=line><span class=cl>	<span class=nx>_</span>       <span class=kt>uint32</span>  <span class=c1>// unused</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>æ¯”å¦‚è¿™é‡Œçš„Moffå°±è®°å½•è¿™äº›<strong>æ–¹æ³•å…ƒæ•°æ®ç»„æˆçš„æ•°ç»„</strong>ç›¸å¯¹äºè¿™ä¸ªuncommontypeç»“æ„ä½“åç§»äº†å¤šå°‘ä¸ªå­—èŠ‚ï¼Œè¿›è€Œæˆ‘ä»¬å°±å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•å…ƒæ•°æ®</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-5-1><a class=lnlinks href=#hl-5-1>1</a>
</span><span class=lnt id=hl-5-2><a class=lnlinks href=#hl-5-2>2</a>
</span><span class=lnt id=hl-5-3><a class=lnlinks href=#hl-5-3>3</a>
</span><span class=lnt id=hl-5-4><a class=lnlinks href=#hl-5-4>4</a>
</span><span class=lnt id=hl-5-5><a class=lnlinks href=#hl-5-5>5</a>
</span><span class=lnt id=hl-5-6><a class=lnlinks href=#hl-5-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>Method</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Name</span> <span class=nx>NameOff</span> <span class=c1>// name of method</span>
</span></span><span class=line><span class=cl>	<span class=nx>Mtyp</span> <span class=nx>TypeOff</span> <span class=c1>// method type (without receiver)</span>
</span></span><span class=line><span class=cl>	<span class=nx>Ifn</span>  <span class=nx>TextOff</span> <span class=c1>// fn used in interface call (one-word receiver)</span>
</span></span><span class=line><span class=cl>	<span class=nx>Tfn</span>  <span class=nx>TextOff</span> <span class=c1>// fn used for normal method call</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=/posts/golang/interface/001.png></p><p>å› æ­¤è®°å¿†ä¸‹æ¥çš„è¯ç±»å‹ä¿¡æ¯<strong>å°±æ˜¯<code>_type</code>åŠ ä¸Šä¸€å †é¢å¤–çš„ä¿¡æ¯ç½¢äº†</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-6-1><a class=lnlinks href=#hl-6-1>1</a>
</span><span class=lnt id=hl-6-2><a class=lnlinks href=#hl-6-2>2</a>
</span><span class=lnt id=hl-6-3><a class=lnlinks href=#hl-6-3>3</a>
</span><span class=lnt id=hl-6-4><a class=lnlinks href=#hl-6-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>T</span> <span class=kd>struct</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Type</span>    <span class=c1>// meta data</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>     <span class=c1>// extra data</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=é‚£å°±è®¤è¯†ä¸€ä¸‹æ¥å£å§>é‚£å°±è®¤è¯†ä¸€ä¸‹æ¥å£å§<a hidden class=anchor aria-hidden=true href=#é‚£å°±è®¤è¯†ä¸€ä¸‹æ¥å£å§>#</a></h2><p>Go è¯­è¨€ä½¿ç”¨<code>runtime.iface</code>è¡¨ç¤ºç¬¬ä¸€ç§æ¥å£ï¼Œä½¿ç”¨<code>runtime.eface</code>è¡¨ç¤ºç¬¬äºŒç§ä¸åŒ…å«ä»»ä½•æ–¹æ³•çš„æ¥å£ <code>interface{}</code>ï¼Œä¸¤ç§æ¥å£è™½ç„¶éƒ½ä½¿ç”¨<code>interface</code>å£°æ˜ï¼Œä½†æ˜¯ç”±äºåè€…åœ¨Goä¸­å¾ˆå¸¸è§ï¼Œæ‰€ä»¥åœ¨å®ç°æ—¶ä½¿ç”¨äº†ç‰¹æ®Šçš„ç±»å‹ä»ä½†å•ç‹¬åŒºåˆ†å‡ºæ¥ã€‚</p><ul><li><strong>ç©ºæ¥å£</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-7-1><a class=lnlinks href=#hl-7-1>1</a>
</span><span class=lnt id=hl-7-2><a class=lnlinks href=#hl-7-2>2</a>
</span><span class=lnt id=hl-7-3><a class=lnlinks href=#hl-7-3>3</a>
</span><span class=lnt id=hl-7-4><a class=lnlinks href=#hl-7-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>eface</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>_type</span> <span class=o>*</span><span class=nx>_type</span>        <span class=c1>// dynamic type</span>
</span></span><span class=line><span class=cl>	<span class=nx>data</span>  <span class=nx>unsafe</span><span class=p>.</span><span class=nx>Pointer</span><span class=c1>// dynamic data</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>å½“åˆå§‹åŒ–çš„æ—¶å€™<code>var a interface{}</code>ï¼Œ<code>_type</code> å’Œ <code>data</code> éƒ½ä¸º<code>nil</code>ï¼Œä½†å½“æˆ‘ä»¬ä¸ºå…¶èµ‹å€¼çš„æ—¶å€™
æ¯”å¦‚èµ‹å€¼<code>*os.File</code>ç»™è¿™ä¸ªç©ºæ¥å£ï¼Œ<code>_type</code>å°±ä¼šæŒ‡å‘è¿™ä¸ªè‡ªå®šä¹‰ç±»å‹çš„<strong>ç±»å‹å…ƒæ•°æ®</strong>ï¼Œ<code>data</code>å°±ä¼šç›´æ¥è¢«è¿™ä¸ªæŒ‡é’ˆèµ‹å€¼ã€‚</p><ul><li><strong>éç©ºæ¥å£</strong>
å…¶å®å°±æ˜¯æœ‰æ–¹æ³•åˆ—è¡¨çš„æ¥å£ç±»å‹ï¼Œå¦‚æœä¸€ä¸ªå˜é‡è¦æƒ³èµ‹å€¼ç»™ä¸€ä¸ªéç©ºæ¥å£ç±»å‹ï¼Œå¿…é¡»è¦å®ç°è¯¥æ¥å£è¦æ±‚çš„æ‰€æœ‰æ–¹æ³•æ‰è¡Œã€‚</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-8-1><a class=lnlinks href=#hl-8-1>1</a>
</span><span class=lnt id=hl-8-2><a class=lnlinks href=#hl-8-2>2</a>
</span><span class=lnt id=hl-8-3><a class=lnlinks href=#hl-8-3>3</a>
</span><span class=lnt id=hl-8-4><a class=lnlinks href=#hl-8-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>iface</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>tab</span>  <span class=o>*</span><span class=nx>itab</span>          <span class=c1>// method list, dynamic type ...</span>
</span></span><span class=line><span class=cl>	<span class=nx>data</span> <span class=nx>unsafe</span><span class=p>.</span><span class=nx>Pointer</span> <span class=c1>// dynamic data</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ä¸ç©ºæ¥å£ä¸€æ ·ï¼Œdataä¸€å®šå­˜å‚¨å®ç°è¿™ä¸ªæ¥å£çš„åŠ¨æ€å€¼ï¼Œå› æ­¤æ¥å£æ‰€è¦å®ç°çš„æ–¹æ³•åˆ—è¡¨ä»¥åŠåŠ¨æ€ç±»å‹ä¿¡æ¯ç­‰ç­‰é‚£å°±åªèƒ½å­˜å‚¨åœ¨è¿™ä¸ª<code>*itab</code>é‡Œé¢å•¦</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-9-1><a class=lnlinks href=#hl-9-1>1</a>
</span><span class=lnt id=hl-9-2><a class=lnlinks href=#hl-9-2>2</a>
</span><span class=lnt id=hl-9-3><a class=lnlinks href=#hl-9-3>3</a>
</span><span class=lnt id=hl-9-4><a class=lnlinks href=#hl-9-4>4</a>
</span><span class=lnt id=hl-9-5><a class=lnlinks href=#hl-9-5>5</a>
</span><span class=lnt id=hl-9-6><a class=lnlinks href=#hl-9-6>6</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>ITab</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Inter</span> <span class=o>*</span><span class=nx>InterfaceType</span>
</span></span><span class=line><span class=cl>	<span class=nx>Type</span>  <span class=o>*</span><span class=nx>Type</span>
</span></span><span class=line><span class=cl>	<span class=nx>Hash</span>  <span class=kt>uint32</span>     <span class=c1>// copy of Type.Hash. Used for type switches.</span>
</span></span><span class=line><span class=cl>	<span class=nx>Fun</span>   <span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=kt>uintptr</span> <span class=c1>// variable sized. fun[0]==0 means Type does not implement Inter.</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>ä¾‹å¦‚æˆ‘ä»¬åˆå§‹åŒ–ä¸€ä¸ª<code>io.ReadWriter</code>çš„æ¥å£ï¼Œ<code>tab</code> å’Œ <code>data</code> éƒ½ä¸º<code>nil</code>ï¼Œä½†å½“æˆ‘ä»¬ä¸ºå…¶èµ‹å€¼<code>*os.File</code>çš„æ—¶å€™ï¼Œ<code>data</code>å°±ä¼šç›´æ¥è¢«è¿™ä¸ªæŒ‡é’ˆèµ‹å€¼ï¼Œè€Œ<code>tab</code>ä¼šæŒ‡å‘ä¸€ä¸ª<code>itab</code>çš„ç»“æ„ä½“ï¼Œ<code>inter</code>æŒ‡å‘<code>io.ReadWriter</code>çš„æ¥å£ä¿¡æ¯ï¼Œ<code>type</code>æŒ‡å‘<code>*os.File</code>çš„ç±»å‹å…ƒä¿¡æ¯ï¼Œ<code>hash</code>ä¸ºç±»å‹å…ƒæ•°æ®ä¸­æ‹·è´çš„å“ˆå¸Œï¼Œ<code>fun</code>ä¸ºå„ä¸ªæ–¹æ³•çš„åœ°å€çš„æ‹·è´
<img loading=lazy src=/posts/golang/interface/002.png></p><p><strong>itabç¼“å­˜</strong>
ä½†å…³äº<code>itab</code>è¦é‡ç‚¹å¼ºè°ƒçš„æ˜¯ï¼Œä¸€æ—¦<strong>æ¥å£ç±»å‹</strong>ç¡®å®šäº†ï¼Œ<strong>åŠ¨æ€ç±»å‹çš„å…ƒä¿¡æ¯</strong>ç¡®å®šäº†ï¼Œé‚£ä¹ˆ<code>itab</code>çš„å†…å®¹å°±ä¸ä¼šæ”¹å˜äº†ï¼Œæ‰€ä»¥itabæ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œæ‰€ä»¥Goè¿è¡Œçš„æ—¶å€™ä¼šæŠŠç”¨åˆ°çš„<code>iteb</code>ç»“æ„ä½“ç¼“å­˜èµ·æ¥ï¼Œå¹¶ä¸”ä»¥<code>&lt;æ¥å£ç±»å‹ï¼ŒåŠ¨æ€ç±»å‹></code>ä¸ºkeyï¼Œ<code>iteb</code>ä¸ºvalueæ„å»ºå‡ºä¸€ä¸ªå“ˆå¸Œè¡¨ã€‚è¿™é‡Œä½¿ç”¨<code>itabHashFunc</code>æ–¹æ³•å¾—åˆ°keyè¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæœ‰å°±ç›´æ¥ä½¿ç”¨ï¼Œæ²¡æœ‰å°±ä¼šåˆ›å»ºæ–°çš„<code>itab</code>ç»“æ„ä½“æ·»åŠ åˆ°è¿™ä¸ªå“ˆå¸Œè¡¨ä¸­</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-10-1><a class=lnlinks href=#hl-10-1> 1</a>
</span><span class=lnt id=hl-10-2><a class=lnlinks href=#hl-10-2> 2</a>
</span><span class=lnt id=hl-10-3><a class=lnlinks href=#hl-10-3> 3</a>
</span><span class=lnt id=hl-10-4><a class=lnlinks href=#hl-10-4> 4</a>
</span><span class=lnt id=hl-10-5><a class=lnlinks href=#hl-10-5> 5</a>
</span><span class=lnt id=hl-10-6><a class=lnlinks href=#hl-10-6> 6</a>
</span><span class=lnt id=hl-10-7><a class=lnlinks href=#hl-10-7> 7</a>
</span><span class=lnt id=hl-10-8><a class=lnlinks href=#hl-10-8> 8</a>
</span><span class=lnt id=hl-10-9><a class=lnlinks href=#hl-10-9> 9</a>
</span><span class=lnt id=hl-10-10><a class=lnlinks href=#hl-10-10>10</a>
</span><span class=lnt id=hl-10-11><a class=lnlinks href=#hl-10-11>11</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Note: change the formula in the mallocgc call in itabAdd if you change these fields.</span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>itabTableType</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>size</span>    <span class=kt>uintptr</span>             <span class=c1>// length of entries array. Always a power of 2.</span>
</span></span><span class=line><span class=cl>	<span class=nx>count</span>   <span class=kt>uintptr</span>             <span class=c1>// current number of filled entries.</span>
</span></span><span class=line><span class=cl>	<span class=nx>entries</span> <span class=p>[</span><span class=nx>itabInitSize</span><span class=p>]</span><span class=o>*</span><span class=nx>itab</span> <span class=c1>// really [size] large</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>itabHashFunc</span><span class=p>(</span><span class=nx>inter</span> <span class=o>*</span><span class=nx>interfacetype</span><span class=p>,</span> <span class=nx>typ</span> <span class=o>*</span><span class=nx>_type</span><span class=p>)</span> <span class=kt>uintptr</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// compiler has provided some good hash codes for us.</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nb>uintptr</span><span class=p>(</span><span class=nx>inter</span><span class=p>.</span><span class=nx>Type</span><span class=p>.</span><span class=nx>Hash</span> <span class=p>^</span> <span class=nx>typ</span><span class=p>.</span><span class=nx>Hash</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=ç±»å‹æ–­è¨€>ç±»å‹æ–­è¨€<a hidden class=anchor aria-hidden=true href=#ç±»å‹æ–­è¨€>#</a></h2><p>åˆšåˆšèŠè¿‡äº†ç©ºæ¥å£å’Œéç©ºæ¥å£ä¸¤ç§æ¥å£ï¼Œè€Œç±»å‹æ–­è¨€å°±æ˜¯ä½œç”¨åœ¨æ¥å£å€¼ä¹‹ä¸Š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-11-1><a class=lnlinks href=#hl-11-1>1</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>æ¥å£æˆ–è€…éç©ºæ¥å£.(å…·ä½“ç±»å‹æˆ–éç©ºæ¥å£ç±»å‹)
</span></span></code></pre></td></tr></table></div></div><p>è¿™å°±æ’åˆ—ç»„åˆå‡ºæ¥äº†<strong>4ç§ç±»å‹æ–­è¨€</strong>ï¼Œé‚£æˆ‘ä»¬å°±é€ä¸€æ¥çœ‹çœ‹ï¼Œä»–ä»¬æ˜¯æ€æ ·è¿›è¡Œç±»å‹æ–­è¨€çš„</p><ul><li><strong>ç©ºæ¥å£.(å…·ä½“ç±»å‹)</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-12-1><a class=lnlinks href=#hl-12-1>1</a>
</span><span class=lnt id=hl-12-2><a class=lnlinks href=#hl-12-2>2</a>
</span><span class=lnt id=hl-12-3><a class=lnlinks href=#hl-12-3>3</a>
</span><span class=lnt id=hl-12-4><a class=lnlinks href=#hl-12-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>eface</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>_type</span> <span class=o>*</span><span class=nx>_type</span>        <span class=c1>// dynamic type</span>
</span></span><span class=line><span class=cl>	<span class=nx>data</span>  <span class=nx>unsafe</span><span class=p>.</span><span class=nx>Pointer</span><span class=c1>// dynamic data</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ç©ºæ¥å£ï¼Œæ˜¾ç„¶ï¼Œç±»å‹æ–­è¨€çš„æ—¶å€™åªéœ€è¦æ£€æŸ¥è¿™é‡Œçš„<code>_type</code>æ˜¯å¦æ˜¯å…·ä½“ç±»å‹çš„ç±»å‹å…ƒæ•°æ®å³å¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-13-1><a class=lnlinks href=#hl-13-1>1</a>
</span><span class=lnt id=hl-13-2><a class=lnlinks href=#hl-13-2>2</a>
</span><span class=lnt id=hl-13-3><a class=lnlinks href=#hl-13-3>3</a>
</span><span class=lnt id=hl-13-4><a class=lnlinks href=#hl-13-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>e</span> <span class=kd>interface</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=nx>f</span> <span class=o>:=</span> <span class=s>&#34;whitea&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>e</span> <span class=p>=</span> <span class=nx>f</span>
</span></span><span class=line><span class=cl><span class=nx>r</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>e</span><span class=p>.(</span><span class=o>*</span><span class=nx>os</span><span class=p>.</span><span class=nx>File</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™é‡Œ<code>data</code>å°±ä¼šè¢«<code>f</code>èµ‹å€¼ï¼Œç±»å‹å…ƒæ•°æ®æ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œè¿™é‡Œä¹Ÿæ˜¯å¯¹çš„ä¸Šçš„ï¼Œæ‰€ä»¥æ–­è¨€æˆåŠŸï¼Œ<code>r</code>å³ä¸º<code>f</code>,<code>ok</code>ä¸º<code>true</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-14-1><a class=lnlinks href=#hl-14-1>1</a>
</span><span class=lnt id=hl-14-2><a class=lnlinks href=#hl-14-2>2</a>
</span><span class=lnt id=hl-14-3><a class=lnlinks href=#hl-14-3>3</a>
</span><span class=lnt id=hl-14-4><a class=lnlinks href=#hl-14-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>e</span> <span class=kd>interface</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=nx>f</span> <span class=o>:=</span> <span class=s>&#34;whitea&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>e</span> <span class=p>=</span> <span class=nx>f</span>
</span></span><span class=line><span class=cl><span class=nx>r</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>e</span><span class=p>.(</span><span class=kt>string</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™é‡Œç”±äºç±»å‹å…ƒæ•°æ®å¯¹ä¸ä¸Šï¼Œå› æ­¤<code>r</code>å³ä¸º<code>nil</code>,<code>ok</code>ä¸º<code>false</code></p><ul><li><strong>éç©ºæ¥å£.(å…·ä½“ç±»å‹)</strong></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-15-1><a class=lnlinks href=#hl-15-1>1</a>
</span><span class=lnt id=hl-15-2><a class=lnlinks href=#hl-15-2>2</a>
</span><span class=lnt id=hl-15-3><a class=lnlinks href=#hl-15-3>3</a>
</span><span class=lnt id=hl-15-4><a class=lnlinks href=#hl-15-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>iface</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>tab</span>  <span class=o>*</span><span class=nx>itab</span>          <span class=c1>// method list, dynamic type ...</span>
</span></span><span class=line><span class=cl>	<span class=nx>data</span> <span class=nx>unsafe</span><span class=p>.</span><span class=nx>Pointer</span> <span class=c1>// dynamic data</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>åŒæ ·å…ˆæŠŠéç©ºæ¥å£ç±»å‹çš„ç»“æ„æ‹¿è¿‡æ¥ï¼Œä¹‹å‰è¯´åˆ°è¿‡æ‰€æœ‰çš„<code>itab</code>ç»“æ„ä½“éƒ½ä¼šè¢«ç¼“å­˜èµ·æ¥ï¼Œç„¶åé€šè¿‡<code>&lt;æ¥å£ç±»å‹ï¼Œç±»å‹å…ƒæ•°æ®></code>ä¸ºkeyç¼“å­˜ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿæ˜¯åªéœ€è¦è®¡ç®—ä¸€ä¸‹keyçš„ä½ç½®ï¼Œæ¯”è¾ƒä¸€æ¬¡å³å¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-16-1><a class=lnlinks href=#hl-16-1>1</a>
</span><span class=lnt id=hl-16-2><a class=lnlinks href=#hl-16-2>2</a>
</span><span class=lnt id=hl-16-3><a class=lnlinks href=#hl-16-3>3</a>
</span><span class=lnt id=hl-16-4><a class=lnlinks href=#hl-16-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>rw</span> <span class=nx>io</span><span class=p>.</span><span class=nx>ReadWriter</span>
</span></span><span class=line><span class=cl><span class=nx>f</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=s>&#34;whitea.md&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>re</span> <span class=p>=</span> <span class=nx>f</span>
</span></span><span class=line><span class=cl><span class=nx>r</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>rw</span><span class=p>.(</span><span class=o>*</span><span class=nx>os</span><span class=p>.</span><span class=nx>File</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™é‡Œ<code>data</code>å°±ä¼šè¢«<code>f</code>èµ‹å€¼ï¼Œç±»å‹å…ƒæ•°æ®å’Œæ¥å£ç±»å‹å“ˆå¸Œå¼‚æˆ–è¿ç®—åæŸ¥æ‰¾<code>itab</code>ä¹Ÿèƒ½å¯¹çš„ä¸Šï¼Œæ‰€ä»¥æ–­è¨€æˆåŠŸï¼Œ<code>r</code>å³ä¸º<code>f</code>,<code>ok</code>ä¸º<code>true</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-17-1><a class=lnlinks href=#hl-17-1>1</a>
</span><span class=lnt id=hl-17-2><a class=lnlinks href=#hl-17-2>2</a>
</span><span class=lnt id=hl-17-3><a class=lnlinks href=#hl-17-3>3</a>
</span><span class=lnt id=hl-17-4><a class=lnlinks href=#hl-17-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>rw</span> <span class=nx>io</span><span class=p>.</span><span class=nx>ReadWriter</span>
</span></span><span class=line><span class=cl><span class=nx>f</span> <span class=err>ï¼š</span><span class=p>=</span> <span class=nx>whitea</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;whitea&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>re</span> <span class=p>=</span> <span class=nx>f</span>
</span></span><span class=line><span class=cl><span class=nx>r</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>rw</span><span class=p>.(</span><span class=o>*</span><span class=nx>os</span><span class=p>.</span><span class=nx>File</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™é‡Œ<code>data</code>å°±ä¼šè¢«<code>f</code>èµ‹å€¼ï¼Œç±»å‹å…ƒæ•°æ®å’Œæ¥å£ç±»å‹å“ˆå¸Œå¼‚æˆ–è¿ç®—åæŸ¥æ‰¾<code>itab</code>çš„ç±»å‹å…ƒæ•°æ®ä¸ä¸€æ ·ï¼Œ<code>itab</code>å¯¹ä¸ä¸Šï¼Œæ‰€ä»¥æ–­è¨€å¤±è´¥ï¼Œ<code>r</code>å³ä¸º<code>nil</code>,<code>ok</code>ä¸º<code>false</code></p><ul><li><strong>ç©ºæ¥å£.(éç©ºæ¥å£)</strong>
åŒç†æ˜¯éœ€è¦æ¯”è¾ƒ<code>_type</code>æ˜¯å¦ä¸€è‡´ï¼Œä½†æ˜¯è¿™é‡Œè¿˜éœ€è¦æ¯”è¾ƒè¿™ä¸ªç±»å‹æ˜¯å¦å®ç°äº†éç©ºæ¥å£ç±»å‹çš„æ‰€æœ‰æ–¹æ³•ï¼Œå› æ­¤è¿˜æ¶‰åŠåˆ°<code>itab</code>æŸ¥æ‰¾ä»¥åŠ<code>fun</code>æ•°ç»„çš„æ¯”è¾ƒç­‰æ“ä½œ</li></ul><blockquote><p>ä½†æ˜¯è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ¯”è¾ƒå¤±è´¥çš„<code>itab</code>ç»“æ„ä½“ä¹Ÿä¼šè¢«ç¼“å­˜èµ·æ¥ï¼ŒåŒæ—¶<code>fun[0] = 0</code>ç”¨äºè¡¨ç¤ºè¿™ä¸ªåŠ¨æ€ç±»å‹å¹¶æ²¡æœ‰å®ç°å¯¹åº”çš„æ¥å£ï¼Œè¿™æ ·ä¹‹åå†æ¬¡é‡åˆ°åŒç§çš„ç±»å‹æ–­è¨€æ—¶å€™å°±å¯ä»¥ç›´æ¥è¿”å›<code>false</code>äº†ï¼Œå°±ä¸ç”¨å†å»æ£€æŸ¥æ–¹æ³•åˆ—è¡¨äº†ã€‚</p></blockquote><ul><li><strong>éç©ºæ¥å£.(éç©ºæ¥å£)</strong>
è¿™é‡ŒåŒæ ·ä¸ä»…ä»…éœ€è¦æ¯”è¾ƒ<code>itab</code>é‡Œé¢çš„ç±»å‹å…ƒæ•°æ®ï¼Œä¹Ÿè¦æ¯”è¾ƒ<code>itab</code>é‡Œé¢çš„æ¥å£ç±»å‹å’Œæ–¹æ³•åˆ—è¡¨æ˜¯å¦éƒ½å®ç°äº†ï¼Œè¿™åŒæ ·æ¶‰åŠå»ç¼“å­˜é‡Œé¢å¯»æ‰¾ã€‚</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-18-1><a class=lnlinks href=#hl-18-1>1</a>
</span><span class=lnt id=hl-18-2><a class=lnlinks href=#hl-18-2>2</a>
</span><span class=lnt id=hl-18-3><a class=lnlinks href=#hl-18-3>3</a>
</span><span class=lnt id=hl-18-4><a class=lnlinks href=#hl-18-4>4</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>w</span> <span class=nx>io</span><span class=p>.</span><span class=nx>Writer</span>
</span></span><span class=line><span class=cl><span class=nx>f</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=s>&#34;whitea.md&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>re</span> <span class=p>=</span> <span class=nx>f</span>
</span></span><span class=line><span class=cl><span class=nx>r</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>rw</span><span class=p>.(</span><span class=o>*</span><span class=nx>os</span><span class=p>.</span><span class=nx>File</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™é‡Œæ˜¯æ–­è¨€æˆåŠŸçš„</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt id=hl-19-1><a class=lnlinks href=#hl-19-1> 1</a>
</span><span class=lnt id=hl-19-2><a class=lnlinks href=#hl-19-2> 2</a>
</span><span class=lnt id=hl-19-3><a class=lnlinks href=#hl-19-3> 3</a>
</span><span class=lnt id=hl-19-4><a class=lnlinks href=#hl-19-4> 4</a>
</span><span class=lnt id=hl-19-5><a class=lnlinks href=#hl-19-5> 5</a>
</span><span class=lnt id=hl-19-6><a class=lnlinks href=#hl-19-6> 6</a>
</span><span class=lnt id=hl-19-7><a class=lnlinks href=#hl-19-7> 7</a>
</span><span class=lnt id=hl-19-8><a class=lnlinks href=#hl-19-8> 8</a>
</span><span class=lnt id=hl-19-9><a class=lnlinks href=#hl-19-9> 9</a>
</span><span class=lnt id=hl-19-10><a class=lnlinks href=#hl-19-10>10</a>
</span><span class=lnt id=hl-19-11><a class=lnlinks href=#hl-19-11>11</a>
</span><span class=lnt id=hl-19-12><a class=lnlinks href=#hl-19-12>12</a>
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>var</span> <span class=nx>rw</span> <span class=nx>io</span><span class=p>.</span><span class=nx>ReadWriter</span>
</span></span><span class=line><span class=cl><span class=nx>f</span> <span class=err>ï¼š</span><span class=p>=</span> <span class=nx>whitea</span><span class=p>{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;whitea&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>re</span> <span class=p>=</span> <span class=nx>f</span>
</span></span><span class=line><span class=cl><span class=nx>r</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>rw</span><span class=p>.(</span><span class=o>*</span><span class=nx>os</span><span class=p>.</span><span class=nx>File</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>whitea</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>w</span> <span class=nx>whitea</span><span class=p>)</span> <span class=nf>Write</span><span class=p>(</span><span class=nx>b</span> <span class=p>[]</span><span class=kt>byte</span><span class=p>)</span> <span class=p>(</span><span class=nx>n</span> <span class=kt>int</span><span class=p>,</span> <span class=nx>err</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>len</span><span class=p>(</span><span class=nx>w</span><span class=p>.</span><span class=nx>name</span><span class=p>),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™é‡Œçš„è‡ªå®šä¹‰ç±»å‹åªå®ç°äº†Writeæ¥å£ï¼Œè¿˜æœ‰Readæ¥å£æ²¡æœ‰å®ç°ï¼Œå› æ­¤ç±»å‹æ–­è¨€å¤±è´¥ï¼Œè¿™ä¸ª<code>itab</code>è¢«ç¼“å­˜èµ·æ¥ï¼Œ<code>r</code>å³ä¸º<code>nil</code>,<code>ok</code>ä¸º<code>false</code></p><p>å› æ­¤ç±»å‹æ–­è¨€çš„å…³é”®å°±åœ¨äº<strong>æ˜ç¡®æ¥å£çš„åŠ¨æ€ç±»å‹(<code>_type</code>)ä»¥åŠå¯¹åº”çš„ç±»å‹å®ç°äº†å“ªäº›æ–¹æ³•</strong>ã€‚è€Œéœ€è¦æ˜ç¡®è¿™äº›åˆ™ä¾èµ–ä¸ç±»å‹å…ƒæ•°æ®ä»¥åŠç©ºæ¥å£å’Œéç©ºæ¥å£çš„â€œæ•°æ®æ¥å£â€</p><p>OKï¼Goçš„ç±»å‹ç³»ç»Ÿã€æ¥å£ã€ç±»å‹æ–­è¨€å°±å…ˆè®²åˆ°è¿™é‡Œã€‚</p><blockquote><p>ä½œä¸ºä¸€åå°ç™½Gopher,æœ‰ä»»ä½•é—®é¢˜éƒ½å¯ä»¥è”ç³»æˆ‘ï¼Œå½“ç„¶ä¹Ÿæ¬¢è¿ä¸æˆ‘äº¤æµæŠ€æœ¯ç›¸å…³çš„é—®é¢˜ï¼Œæ„Ÿè°¢ä½ çš„é˜…è¯»ğŸ¤—</p></blockquote></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/go/>Go</a></li></ul><nav class=paginav><a class=next href=http://localhost:1313/posts/sast/2025-second-class/><span class=title>Next Â»</span><br><span>SASTæˆè¯¾-ä»HTTPåˆ°RPC & æœåŠ¡å‘ç°ä¸æ³¨å†Œ</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>Whitea's Blog</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>